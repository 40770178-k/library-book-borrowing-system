{% extends 'base.html' %}

{% block content %}
  <div class="container mt-4">
    <h2>Borrowed Books List</h2>

    {% if borrowed_books %}
      <table class="table table-bordered table-striped mt-3">
        <thead>
          <tr>
            <th>Member</th>
            <th>Book</th>
            <th>Borrow Date</th>
            <th>Due Date</th>
            <th>Return Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for borrow in borrowed_books %}
            <tr>
              <td>{{ borrow.member.fullname }}</td>
              <td>{{ borrow.book.title }}</td>
              <td>{{ borrow.borrow_date }}</td>
              <td>{{ borrow.due_date }}</td>
              <td>
                {% if borrow.is_returned %}
                  Returned on {{ borrow.returndate }}
                {% else %}
                  {% if borrow.due_date < now %}
                    <span class="badge bg-danger">Overdue (Due {{ borrow.due_date|date:"M d" }})</span>
                  {% else %}
                    <span class="text-warning">Not Returned (Due {{ borrow.due_date|date:"M d" }})</span>
                  {% endif %}
                {% endif %}
              </td>
              <td>
                {% if not borrow.is_returned %}
                  {% if borrow.member.user == request.user %}
                    <form action="{% url 'return_book' borrow.pk %}" method="post" style="display:inline;">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-sm btn-success">
                        Mark as Returned
                      </button>
                    </form>
                  {% else %}
                    <span class="text-muted">Not Yours</span>
                  {% endif %}
                {% else %}
                  <span class="text-muted">Completed</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No borrowed books found.</p>
    {% endif %}
  </div>
{% endblock %}
